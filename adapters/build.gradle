import org.gradle.internal.os.OperatingSystem

def isGLFWProject() {
    return project.name.toLowerCase().startsWith("glfw")
}

def glfwSetup() {
    /* DO NOT EDIT THIS BLOCK: it is generated by LWJGL -------------------- */
    project.ext.lwjglVersion = "3.3.0"

    switch (OperatingSystem.current()) {
        case OperatingSystem.LINUX:
            def osArch = System.getProperty("os.arch")
            project.ext.lwjglNatives = osArch.startsWith("arm") || osArch.startsWith("aarch64") ? "natives-linux-${osArch.contains("64") || osArch.startsWith("armv8") ? "arm64" : "arm32"}" : "natives-linux"
            break
        case OperatingSystem.MAC_OS:
            project.ext.lwjglNatives = System.getProperty("os.arch").startsWith("aarch64") ? "natives-macos-arm64" : "natives-macos"
            break
        case OperatingSystem.WINDOWS:
            def osArch = System.getProperty("os.arch")
            project.ext.lwjglNatives = osArch.contains("64") ? "natives-windows${osArch.startsWith("aarch64") ? "-arm64" : ""}" : "natives-windows-x86"
            break
    }
    /* --------------------------------------------------------------------- */
}

def isHidUsbProject() {
    return project.name.toLowerCase().startsWith("hid-usb")
}

subprojects {
    apply plugin: 'java-library'

    dependencies {
        api project(':api')

        if(isGLFWProject()) {
            glfwSetup()

            /*
             * TODO: Find a way to add these dependencies from glfw.gradle.
             * If determined to be impossible, remove this comment.
             */
            /* DO NOT EDIT THIS BLOCK: it is generated by LWJGL ------------ */
            implementation "org.lwjgl:lwjgl"
            implementation "org.lwjgl:lwjgl-glfw"
            implementation platform("org.lwjgl:lwjgl-bom:$project.lwjglVersion")

            runtimeOnly "org.lwjgl:lwjgl::$project.lwjglNatives"
            runtimeOnly "org.lwjgl:lwjgl-glfw::$project.lwjglNatives"
            /* ------------------------------------------------------------- */
        } else if(isHidUsbProject()) {
            /*
             * TODO: Find a way to add these dependencies from hid-usb.gradle.
             * If determined to be impossible, remove this comment.
             */
            implementation 'javax.usb:usb-api:1.0.2'
            implementation 'net.java.dev.jna:jna:5.9.0'
            implementation 'org.hid4java:hid4java:0.7.0'
            implementation 'org.usb4java:usb4java:1.3.0'
            implementation 'org.usb4java:usb4java-javax:1.3.0'
        }
    }

    archivesBaseName = "${rootProject.name}-${this.name}-${project.name}"
}
